<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.ico"><link rel="canonical" href="https://www.biosconfessions.com/posts/refactoring-a-bad-design-a-step-by-step-example/"><meta name="generator" content="Astro v5.12.9"><!-- Google tag (gtag.js) --><script type="text/partytown" async src="https://www.googletagmanager.com/gtag/js?id=G-E96HPDSNG8"></script><script type="text/partytown">
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());

            gtag("config", "G-E96HPDSNG8");
        </script><!-- Global Metadata --><title>Refactoring a Bad Design: A Step-by-Step Example | BIOS Confessions</title><meta name="author" content="Quinn &#38; Gianni"><meta name="title" content="Refactoring a Bad Design: A Step-by-Step Example | BIOS Confessions"><meta name="description" content="Learn how to refactor an overgrown Java class using incremental steps, abstractions, and unit testing."><meta name="keywords" content="Software Design Patterns, Refactoring Java Code, Clean Code Practices, Software Architecture, UserManager Class Example, Technical Debt Management, Java Unit Testing, Mocking in Java (Mockito), Code Maintainability, Incremental Refactoring, Testable Code Design, Object-Oriented Design Principles, Single Responsibility Principle (SRP)"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Refactoring a Bad Design: A Step-by-Step Example | BIOS Confessions" href="https://www.biosconfessions.com/rss.xml"><!-- Open Graph / Facebook --><meta property="og:title" content="Refactoring a Bad Design: A Step-by-Step Example | BIOS Confessions"><meta property="og:description" content="Learn how to refactor an overgrown Java class using incremental steps, abstractions, and unit testing."><meta property="og:type" content="website"><meta property="og:url" content="https://www.biosconfessions.com/posts/refactoring-a-bad-design-a-step-by-step-example/"><meta property="og:image" content="https://www.biosconfessions.com/[object%20Object]"><!-- Twitter --><meta property="twitter:title" content="Refactoring a Bad Design: A Step-by-Step Example | BIOS Confessions"><meta property="twitter:description" content="Learn how to refactor an overgrown Java class using incremental steps, abstractions, and unit testing."><meta property="twitter:url" content="https://www.biosconfessions.com/posts/refactoring-a-bad-design-a-step-by-step-example/"><meta property="twitter:image" content="https://www.biosconfessions.com/[object%20Object]"><meta property="twitter:card" content="summary_large_image"><link rel="stylesheet" href="/assets/index.MrhJHCfw.css"><script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.11.2 - MIT QwikDev */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,l,d,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(d=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(l=setTimeout(v,(null==s?void 0:s.fallbackTimeout)||1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.11.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<d.length;n++)(o=r.createElement("script")).innerHTML=d[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(l)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="flex flex-col min-h-screen bg-gray-50">  <header> <div class="max-w-3xl w-full mx-auto px-4 space-y-12">  <div class="flex justify-between items-center h-16"> <!-- Logo --> <div class="flex-shrink-0"> <a href="/" tabindex="0" class="text-2xl font-bold text-gray-900 hover:text-gray-700" aria-label="Home" title="Home" aria-disabled="false"> 
BIOS Confessions
 </a> </div> <!-- Desktop Nav --> <nav class="hidden md:flex flex-1 justify-end space-x-4"> <div class="flex group"> <a href="/posts" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="Posts" title="Posts" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> Posts </span> <span class="block w-5 mx-auto h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div><div class="flex group"> <a href="/tags" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="Tags" title="Tags" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> Tags </span> <span class="block w-5 mx-auto h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div><div class="flex group"> <a href="/collections" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="Collections" title="Collections" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> Collections </span> <span class="block w-5 mx-auto h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div><div class="flex group"> <a href="/about" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="About" title="About" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> About </span> <span class="block w-5 mx-auto h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div><div class="flex group"> <a href="/search" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="Search" title="Search" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-4 my-[8px]"> <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path> </svg> </span> <span class="block w-5 mx-auto h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div> </nav> <!-- Mobile Hamburger --> <div class="md:hidden flex items-center"> <button id="menu-button" class="text-gray-900 hover:text-gray-500 focus:outline-none" aria-label="Open Menu" aria-expanded="false" aria-controls="mobile-menu"> <!-- Hamburger Icon --> <svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path> </svg> </button> </div> </div>  </div> <!-- Mobile Menu --> <div id="mobile-menu" class="hidden md:hidden"> <nav class="px-4 py-2 mb-2"> <div class="flex group"> <a href="/posts" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="Posts" title="Posts" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> Posts </span> <span class="block w-5 false h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div><div class="flex group"> <a href="/tags" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="Tags" title="Tags" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> Tags </span> <span class="block w-5 false h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div><div class="flex group"> <a href="/collections" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="Collections" title="Collections" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> Collections </span> <span class="block w-5 false h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div><div class="flex group"> <a href="/about" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="About" title="About" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> About </span> <span class="block w-5 false h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div><div class="flex group"> <a href="/search" tabindex="0" class="flex items-center text-center text-gray-600 group-hover:text-gray-900" aria-label="Search" title="Search" aria-disabled="false">  <span class="block px-1 pt-1 pb-1"> <span class="text-lg md:text-xl pt-1 mb-1 block"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-4 my-[8px]"> <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path> </svg> </span> <span class="block w-5 false h-1 group-hover:bg-gray-900 rounded-full"></span> </span>  </a> </div> </nav> </div> </header> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("menu-button"),n=document.getElementById("mobile-menu");e?.addEventListener("click",()=>{const t=e.getAttribute("aria-expanded")==="true";e.setAttribute("aria-expanded",t?"false":"true"),e.setAttribute("aria-label",t?"Open Menu":"Close Menu"),n?.classList.toggle("hidden")})});</script> <nav> <div class="max-w-3xl w-full mx-auto px-4 space-y-12">  <div class="flex overflow-x-auto"> <div class="flex-1 group"> <a href="/posts/the-harsh-truth-about-your-design-pattern-choices" class="flex items-end justify-center text-center mx-auto px-4 pt-2 w-full text-gray-400 group-hover:text-gray-900"> <span class="block px-1 pt-1 pb-1"> <span class="block text-xs mb-1">
Ch. 1 </span> <span class="text-lg md:text-xl pt-1 mb-1 block"> Truth </span> <span class="block w-5 mx-auto h-1 group-hover:bg-gray-900 rounded-full"></span> </span> </a> </div><div class="flex-1 group"> <a href="/posts/refactoring-a-bad-design-a-step-by-step-example" class="flex items-end justify-center text-center mx-auto px-4 pt-2 w-full text-gray-900 group-hover:text-gray-400"> <span class="block px-1 pt-1 pb-1"> <span class="block text-xs mb-1">
Ch. 2 </span> <span class="text-lg md:text-xl pt-1 mb-1 block"> Truth </span> <span class="block w-5 mx-auto h-1 bg-gray-900 group-hover:bg-gray-400 rounded-full"></span> </span> </a> </div> </div>  </div> </nav><main id="main"> <section class="py-8"> <div class="max-w-3xl w-full mx-auto px-4 space-y-12">  <div class="text-center"> <h1 class="mb-4 text-4xl font-extrabold leading-tight text-gray-900 sm:leading-tight sm:text-5xl lg:text-6xl lg:leading-tight"> Refactoring a Bad Design: A Step-by-Step Example </h1> <div class="px-6 text-sm text-gray-600 font-inter">
By <span class="font-medium">Quinn &amp; Gianni</span> - September 21, 2025 - 10 min </div> <div class="flex gap-3 md:gap-4 mt-4 items-center justify-center"> <a aria-label="Share on X" title="Share on X" href="https://x.com/intent/tweet?url=https%3A%2F%2Fwww.biosconfessions.com%2Fposts%2Frefactoring-a-bad-design-a-step-by-step-example%2F&text=Refactoring%20a%20Bad%20Design%3A%20A%20Step-by-Step%20Example" target="_blank" rel="noopener noreferrer" class="rounded-sm bg-gray-900 hover:bg-gray-50 p-1 text-gray-100 hover:text-gray-900 transition"> <svg xmlns="http://www.w3.org/2000/svg" class="size-6" viewBox="0 0 1200 1227" fill="none"> <g> <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z" fill="currentColor"></path> </g> <defs> <clipPath id="clip0_1_2"> <rect width="1200" height="1227" fill="none"></rect> </clipPath> </defs> </svg> </a> <a aria-label="Share on Facebook" title="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.biosconfessions.com%2Fposts%2Frefactoring-a-bad-design-a-step-by-step-example%2F" target="_blank" rel="noopener noreferrer" class="rounded-lg hover:text-[#4267B2] transition"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 512 512" class="size-8"> <path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" fill="currentColor"></path> </svg> </a> <a aria-label="Share on LinkedIn" title="Share on LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.biosconfessions.com%2Fposts%2Frefactoring-a-bad-design-a-step-by-step-example%2F&title=Refactoring%20a%20Bad%20Design%3A%20A%20Step-by-Step%20Example" target="_blank" rel="noopener noreferrer" class="rounded-lg hover:text-[#0077B5] transition"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 512 512" class="size-8"> <path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" fill="currentColor"></path> </svg> </a> <a aria-label="Share on Reddit" title="Share on Reddit" href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.biosconfessions.com%2Fposts%2Frefactoring-a-bad-design-a-step-by-step-example%2F&title=Refactoring%20a%20Bad%20Design%3A%20A%20Step-by-Step%20Example" target="_blank" rel="noopener noreferrer" class="rounded-lg hover:text-[#FF4500] transition"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 512 512" class="size-8"> <path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" fill="currentColor"></path> </svg> </a> </div> </div> <img src="/assets/BannerRefactoringBadDesign.CtFcZgfN_ZedRWR.webp" alt="Banner" loading="eager" decoding="async" fetchpriority="auto" width="1988" height="1500" class="w-full max-h-[50vh] object-cover md:mpx-8"> </div> </section> <section class="mt-4"> <div class="max-w-3xl w-full mx-auto px-4 space-y-12">  <article class="prose !max-w-none"> <p>Let’s be honest: most projects don’t start with a bad design. Over time, requirements change or new ones get added. Perhaps we have a tight deadline to meet, or maybe we’re just being lazy, but often we will just hack the new requirements into the original design. We just tell ourselves that we’ll refactor this later, but of course, we never do. Imagine a scenario where a seemingly minor piece of unrefactored code caused a system outage. This can result in thousands of dollars in lost revenue within a matter of hours. Such real-world setbacks underscore the critical importance of timely refactoring and set the stage for understanding the need to manage technical debt responsibly.</p>
<p>A few deadlines later, and that “<em>temporary</em>” architecture has roots so deep that nobody wants to touch it. The code works…, but it’s very fragile, hard to test, and impossible to extend without breaking something.</p>
<p>In this article, I will present a small example of a single class that started with good intentions but over time has grown into a monster that only a few of us dare tame. You will be able to translate the techniques I use to tame the beast to your real-life projects.</p>
<h2 id="a-bad-design---setting-the-scene">A bad design - (Setting the scene)</h2>
<p>Let me introduce you to our scene: the UserManager class.</p>
<p>Right now, this class does a bit of everything:</p>
<ul>
<li>Creating user</li>
<li>Saving them to the database</li>
<li>Sending welcome emails</li>
<li>Logging user actions</li>
</ul>
<pre class="astro-code catppuccin-latte" style="background-color:#eff1f5;color:#4c4f69;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word" tabindex="0" data-language="java"><code><span class="line"><span style="color:#8839EF">public</span><span style="color:#8839EF"> class</span><span style="color:#DF8E1D;font-style:italic"> UserManager</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> Database</span><span style="color:#4C4F69"> database</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> EmailService</span><span style="color:#4C4F69"> emailService</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> Logger</span><span style="color:#4C4F69"> logger</span><span style="color:#7C7F93">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#1E66F5;font-style:italic"> UserManager</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">Database</span><span style="color:#E64553;font-style:italic"> database</span><span style="color:#7C7F93">,</span><span style="color:#8839EF"> EmailService</span><span style="color:#E64553;font-style:italic"> emailService</span><span style="color:#7C7F93">,</span><span style="color:#8839EF"> Logger</span><span style="color:#E64553;font-style:italic"> logger</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#D20F39">        this</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">database </span><span style="color:#179299">=</span><span style="color:#4C4F69"> database</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#D20F39">        this</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">emailService </span><span style="color:#179299">=</span><span style="color:#4C4F69"> emailService</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#D20F39">        this</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">logger </span><span style="color:#179299">=</span><span style="color:#4C4F69"> logger</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#8839EF"> void</span><span style="color:#1E66F5;font-style:italic"> createUser</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">String</span><span style="color:#E64553;font-style:italic"> name</span><span style="color:#7C7F93">,</span><span style="color:#8839EF"> String</span><span style="color:#E64553;font-style:italic"> email</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#7C7F93;font-style:italic">        // Save user to database</span></span>
<span class="line"><span style="color:#4C4F69">        database</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">save</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">new</span><span style="color:#1E66F5;font-style:italic"> User</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">name</span><span style="color:#7C7F93">,</span><span style="color:#4C4F69"> email</span><span style="color:#7C7F93">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7C7F93;font-style:italic">        // Send welcome email</span></span>
<span class="line"><span style="color:#4C4F69">        emailService</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">send</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">email</span><span style="color:#7C7F93">,</span><span style="color:#40A02B"> &quot;Welcome to our app!&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7C7F93;font-style:italic">        // Log the action</span></span>
<span class="line"><span style="color:#4C4F69">        logger</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">log</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;User created: {}&quot;</span><span style="color:#7C7F93">,</span><span style="color:#4C4F69"> name</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#8839EF"> void</span><span style="color:#1E66F5;font-style:italic"> deleteUser</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">String</span><span style="color:#E64553;font-style:italic"> email</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        database</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">delete</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">email</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        logger</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">log</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;User deleted: {}&quot;</span><span style="color:#7C7F93">,</span><span style="color:#4C4F69"> email</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"><span style="color:#7C7F93">}</span></span>
<span class="line"></span></code></pre>
<p>Initially, this class was created simply for storing users in a database. Even though you might initially think this class looks fine. It has become a sleeping monster; this class has too many responsibilities, is tightly coupled, and is hard to test. Now, let’s break down the steps needed to start and refactor this.</p>
<h2 id="step-1---identify-the-problem">Step 1 - Identify the problem</h2>
<p>Many developers will see some “Messy” code and think, “I need to rewrite this.” However, let me explain why this could be dangerous. Bad code can still contain a significant amount of business logic, undocumented hacks, and edge cases. For instance, there might be a seemingly redundant line of code that checks if a user’s name is exactly 13 characters long. Although it may seem unusual, it could be an essential edge case for handling inputs from a specific legacy system that incorrectly handles overflow. If you simply rewrite the code, there is a significant chance you will lose the hidden knowledge buried inside the existing codebase.</p>
<p>Instead of immediately rewriting the code, you can better ask yourself the following questions:</p>
<ul>
<li><em><strong>What exactly is wrong?</strong></em></li>
<li><em><strong>Why is it wrong?</strong></em></li>
</ul>
<p>If we answer these questions for our class, it comes down to the problem that the class has too many responsibilities (user creation, persistence, logging, and email sending). This is incorrect because the class has too many responsibilities, creating the risk that changing one thing will break another.</p>
<p>Refactoring this class isn’t just about style. It’s about concerns related to testability and tight coupling.</p>
<h2 id="step-2---choose-a-better-solution">Step 2 - Choose a better solution</h2>
<p>Let’s not be like most developers and skip this part. But instead of just starting and rewriting the code, trying to hammer out a better solution, ask these three questions first:</p>
<ul>
<li><em>What role should this class or component actually play?</em></li>
<li><em>Which responsibility should it keep and which should it rewrite?</em></li>
<li><em>What are the most important constraints right now? (testability, performance, maintainability)</em></li>
</ul>
<p>In our case, the <strong>UserManager</strong> is overwhelmed with various responsibilities, including persistence, notifications, and logging. We need to shift the role of our class from “doing everything” to an orchestrator.</p>
<p>It means the <strong>UserManager</strong> class should just coordinate the workflow. However, it should not be aware of how each specific activity is implemented and executed. We need to create specific classes for each task (<strong>UserRepository, EmailNotifier</strong>).</p>
<p>When we actually try to find a better solution, we’re not just cleaning up the code; we’re also redefining the architecture around the identified problem. We’re not worried about choosing the coolest pattern, but we actually try to find a good solution.</p>
<h2 id="step-3---create-an-implementation-plan">Step 3 - Create an implementation plan</h2>
<p>Now, for this step, we need some real discipline. We identified the problem and found a solution to fix it. What is left but deleting this class and writing it again right!? With this approach, we risk losing working code, introducing new bugs, or even reintroducing the same design problems.</p>
<p>Instead, let’s take a safer approach; think <em>incremental refactoring.</em> We make small and safe changes one at a time, which we can test individually. **This approach will give us a better chance of retaining all functionality.</p>
<p>This is a simple playbook you can follow once ready to implement your solution:</p>
<ol>
<li><strong>Introduce abstraction early.</strong> Try to define your interfaces and abstract classes before implementing them. This approach will help you determine if your predefined contracts are sensible without having to implement them. For our piece of code, we need to create the interfaces <em><strong>UserRepository</strong> and <strong>EmailNotifier.</strong></em></li>
<li><strong>Start with one responsibility.</strong> Don’t take out everything at once. For example, in the <strong>UserManager</strong> class, it would make sense to first extract the logic for the <strong>UserRepository</strong> while keeping the rest of the code intact**.**</li>
<li><strong>Strangle old code.</strong> Don’t delete existing methods straight away. Let the abstraction take over piece by piece. Only remove the old code once you’re confident that you haven’t broken anything and have covered all the expected behaviours.</li>
<li><strong>Test as you go.</strong> After adding the abstraction, write unit tests for it. Verify your implementation and ensure that your refactoring hasn’t broken anything.</li>
<li><strong>Keep the class working at every stage.</strong> Even when you’re in the middle of refactoring, your code should still work. If you follow this approach, it will be easy to identify when and where you could have made a possible mistake.</li>
</ol>
<p>The primary concept of this playbook is straightforward: each step should be reversible. If something fails, you can rollback that step instead of needing to do a massive rewrite and spend a lot of time refactoring.</p>
<h2 id="step-4---implement-the-changes">Step 4 - Implement the changes</h2>
<p>We have finally arrived at the fun part, and we can start refactoring. Let’s refactor our <strong>UserManager</strong> class using the playbook defined in step 3.</p>
<h3 id="step-41-introduce-the-abstraction">Step 4.1 Introduce the abstraction</h3>
<p>Let’s start by introducing some abstraction to the UserManager. Our class does not need to know how the underlying implementation works. We will create two interfaces: one for the EmailManager and one for the UserRepository. The heaviest dependency is the UserRepository, so let’s start removing the direct coupling between the UserManager and the UserRepository.</p>
<p>The UserRepository interface will have two methods: one to save a user and one to delete a user from the database. Our UserRepository will look like this:</p>
<pre class="astro-code catppuccin-latte" style="background-color:#eff1f5;color:#4c4f69;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word" tabindex="0" data-language="java"><code><span class="line"><span style="color:#8839EF">public</span><span style="color:#8839EF"> interface</span><span style="color:#DF8E1D;font-style:italic"> UserRepository</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> save</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">User</span><span style="color:#E64553;font-style:italic"> user</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> deleteById</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">String</span><span style="color:#E64553;font-style:italic"> emailAddress</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">}</span></span></code></pre>
<p>Next, we need to extract the email sending logic. We will follow the same approach where the UserManager class does not need to know the underlying implementation. Our EmailNotifier interface will have one method that allows us to send a welcome email.</p>
<pre class="astro-code catppuccin-latte" style="background-color:#eff1f5;color:#4c4f69;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word" tabindex="0" data-language="java"><code><span class="line"><span style="color:#8839EF">public</span><span style="color:#8839EF"> interface</span><span style="color:#DF8E1D;font-style:italic"> EmailNotifier</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> sendWelcomeEmail</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">String</span><span style="color:#E64553;font-style:italic"> emailAddress</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">}</span></span></code></pre>
<h3 id="step-42-extract-the-persistence-logic">Step 4.2 Extract the persistence logic</h3>
<p>Now that we have defined our interfaces, let’s write an implementation. We will implement the persistence logic in the UserRepository, like this:</p>
<pre class="astro-code catppuccin-latte" style="background-color:#eff1f5;color:#4c4f69;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word" tabindex="0" data-language="java"><code><span class="line"><span style="color:#8839EF">public</span><span style="color:#8839EF"> class</span><span style="color:#DF8E1D;font-style:italic"> UserRepositoryImpl</span><span style="color:#8839EF"> implements</span><span style="color:#DF8E1D;font-style:italic"> UserRepository</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> final</span><span style="color:#8839EF"> Database</span><span style="color:#4C4F69"> database</span><span style="color:#7C7F93">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#1E66F5;font-style:italic"> UserRepositoryImpl</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">Database</span><span style="color:#E64553;font-style:italic"> database</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#D20F39">        this</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">database </span><span style="color:#179299">=</span><span style="color:#4C4F69"> database</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FE640B">    @Override</span></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#8839EF"> void</span><span style="color:#1E66F5;font-style:italic"> save</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">User</span><span style="color:#E64553;font-style:italic"> user</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        database</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">save</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">user</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FE640B">    @Override</span></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#8839EF"> void</span><span style="color:#1E66F5;font-style:italic"> deleteById</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">String</span><span style="color:#E64553;font-style:italic"> emailAddress</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        database</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">delete</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">emailAdress</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"><span style="color:#7C7F93">}</span></span></code></pre>
<h3 id="step-43-extract-the-notification-logic">Step 4.3 Extract the notification logic</h3>
<p>Lastly, we need to implement our second interface: the EmailNotifier. Our implementation will look like this:</p>
<pre class="astro-code catppuccin-latte" style="background-color:#eff1f5;color:#4c4f69;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word" tabindex="0" data-language="java"><code><span class="line"><span style="color:#8839EF">public</span><span style="color:#8839EF"> class</span><span style="color:#DF8E1D;font-style:italic"> EmailNotifierImpl</span><span style="color:#8839EF"> implements</span><span style="color:#DF8E1D;font-style:italic"> EmailNotifier</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> final</span><span style="color:#8839EF"> EmailService</span><span style="color:#4C4F69"> emailService</span><span style="color:#7C7F93">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#1E66F5;font-style:italic"> EmailNotifierImpl</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">EmailService</span><span style="color:#E64553;font-style:italic"> emailService</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#D20F39">        this</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">emailService </span><span style="color:#179299">=</span><span style="color:#4C4F69"> emailService</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FE640B">    @Override</span></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#8839EF"> void</span><span style="color:#1E66F5;font-style:italic"> sendWelcomeEmail</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">String</span><span style="color:#E64553;font-style:italic"> emailAdress</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        emailService</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">send</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">emailAdress</span><span style="color:#7C7F93">,</span><span style="color:#40A02B"> &quot;Welcome to our app!&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"><span style="color:#7C7F93">}</span></span></code></pre>
<h3 id="step-44-update-usermanager-to-orchestration">Step 4.4. Update UserManager to orchestration</h3>
<p>Now, let’s add these interfaces to the UserManager class.</p>
<pre class="astro-code catppuccin-latte" style="background-color:#eff1f5;color:#4c4f69;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word" tabindex="0" data-language="java"><code><span class="line"><span style="color:#8839EF">public</span><span style="color:#8839EF"> class</span><span style="color:#DF8E1D;font-style:italic"> UserManager</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> final</span><span style="color:#8839EF"> UserRepository</span><span style="color:#4C4F69"> userRepository</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> final</span><span style="color:#8839EF"> EmailNotifier</span><span style="color:#4C4F69"> emailNotifier</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> final</span><span style="color:#8839EF"> Logger</span><span style="color:#4C4F69"> logger</span><span style="color:#7C7F93">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#1E66F5;font-style:italic"> UserManager</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">UserRepository</span><span style="color:#E64553;font-style:italic"> userRepository</span><span style="color:#7C7F93">,</span><span style="color:#8839EF"> EmailNotifier</span><span style="color:#E64553;font-style:italic"> emailNotifier</span><span style="color:#7C7F93">,</span><span style="color:#8839EF"> Logger</span><span style="color:#E64553;font-style:italic"> logger</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#D20F39">        this</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">userRepository </span><span style="color:#179299">=</span><span style="color:#4C4F69"> userRepository</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#D20F39">        this</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">emailNotifier </span><span style="color:#179299">=</span><span style="color:#4C4F69"> emailNotifier</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#D20F39">        this</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">logger </span><span style="color:#179299">=</span><span style="color:#4C4F69"> logger</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#8839EF"> void</span><span style="color:#1E66F5;font-style:italic"> createUser</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">String</span><span style="color:#E64553;font-style:italic"> name</span><span style="color:#7C7F93">,</span><span style="color:#8839EF"> String</span><span style="color:#E64553;font-style:italic"> email</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        userRepository</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">save</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">new</span><span style="color:#1E66F5;font-style:italic"> User</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">name</span><span style="color:#7C7F93">,</span><span style="color:#4C4F69"> email</span><span style="color:#7C7F93">));</span></span>
<span class="line"><span style="color:#4C4F69">        emailNotifier</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">sendWelcomeEmail</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">email</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        logger</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">log</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;User created: {}&quot;</span><span style="color:#7C7F93">,</span><span style="color:#4C4F69"> name</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8839EF">    public</span><span style="color:#8839EF"> void</span><span style="color:#1E66F5;font-style:italic"> deleteUser</span><span style="color:#7C7F93">(</span><span style="color:#8839EF">String</span><span style="color:#E64553;font-style:italic"> emailAddress</span><span style="color:#7C7F93">)</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        userRepository</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">deleteById</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">emailAddress</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        logger</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">log</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;User deleted: {}&quot;</span><span style="color:#7C7F93">,</span><span style="color:#4C4F69"> emailAddress</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"><span style="color:#7C7F93">}</span></span></code></pre>
<h2 id="step-45-unit-tests">Step 4.5. Unit tests</h2>
<p>To ensure the robustness and functionality after our refactoring, it is crucial to implement unit tests consistently. Our primary goal is to verify key functionality, such as user management, and confirm that these aspects function without errors. We begin by writing unit tests for each of our interfaces and the UserManager. This involves verifying the core operations of saving and deleting users, ensuring data integrity, and operational reliability.</p>
<pre class="astro-code catppuccin-latte" style="background-color:#eff1f5;color:#4c4f69;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word" tabindex="0" data-language="java"><code><span class="line"><span style="color:#8839EF">class</span><span style="color:#DF8E1D;font-style:italic"> UserRepositoryTests</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> UserRepository</span><span style="color:#4C4F69"> userRepo</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> Database</span><span style="color:#4C4F69"> database</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#4C4F69">	</span></span>
<span class="line"><span style="color:#FE640B">    @BeforeEach</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> init</span><span style="color:#7C7F93">()</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        database </span><span style="color:#179299">=</span><span style="color:#1E66F5;font-style:italic"> mock</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">Database</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">class</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        userRepo </span><span style="color:#179299">=</span><span style="color:#8839EF"> new</span><span style="color:#1E66F5;font-style:italic"> UserRepositoryImpl</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">database</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"><span style="color:#4C4F69">	</span></span>
<span class="line"><span style="color:#FE640B">    @Test</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> testSaveUser</span><span style="color:#7C7F93">()</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">        User</span><span style="color:#4C4F69"> user </span><span style="color:#179299">=</span><span style="color:#8839EF"> new</span><span style="color:#1E66F5;font-style:italic"> User</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;testUser&quot;</span><span style="color:#7C7F93">,</span><span style="color:#40A02B"> &quot;testUser@mail.com&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        userRepo</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">save</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">user</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">    </span></span>
<span class="line"><span style="color:#1E66F5;font-style:italic">        verify</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">database</span><span style="color:#7C7F93">,</span><span style="color:#1E66F5;font-style:italic"> times</span><span style="color:#7C7F93">(</span><span style="color:#FE640B">1</span><span style="color:#7C7F93">)).</span><span style="color:#1E66F5;font-style:italic">save</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">user</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"><span style="color:#4C4F69">	</span></span>
<span class="line"><span style="color:#FE640B">    @Test</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> testDeleteById</span><span style="color:#7C7F93">()</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">        String</span><span style="color:#4C4F69"> email </span><span style="color:#179299">=</span><span style="color:#40A02B"> &quot;testUser@mail.com&quot;</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#4C4F69">        userRepo</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">deleteById</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">email</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">    </span></span>
<span class="line"><span style="color:#1E66F5;font-style:italic">        verify</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">database</span><span style="color:#7C7F93">,</span><span style="color:#1E66F5;font-style:italic"> times</span><span style="color:#7C7F93">(</span><span style="color:#FE640B">1</span><span style="color:#7C7F93">)).</span><span style="color:#1E66F5;font-style:italic">delete</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">email</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"><span style="color:#7C7F93">}</span></span></code></pre>
<p>Next, we need to verify the EmailNotifier. For this interface, we need to check if we can successfully send a welcome email.</p>
<pre class="astro-code catppuccin-latte" style="background-color:#eff1f5;color:#4c4f69;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word" tabindex="0" data-language="java"><code><span class="line"><span style="color:#8839EF">class</span><span style="color:#DF8E1D;font-style:italic"> EmailNotifierTests</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> EmailNotifier</span><span style="color:#4C4F69"> emailNotifier</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> EmailService</span><span style="color:#4C4F69"> emailService</span><span style="color:#7C7F93">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FE640B">    @BeforeEach</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> init</span><span style="color:#7C7F93">()</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        emailService </span><span style="color:#179299">=</span><span style="color:#1E66F5;font-style:italic"> mock</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">EmailService</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">class</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        emailNotifier </span><span style="color:#179299">=</span><span style="color:#8839EF"> new</span><span style="color:#1E66F5;font-style:italic"> EmailNotifierImpl</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">emailService</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FE640B">    @Test</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> testSendWelcomeEmail</span><span style="color:#7C7F93">()</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">        String</span><span style="color:#4C4F69"> email </span><span style="color:#179299">=</span><span style="color:#40A02B"> &quot;testUser@mail.com&quot;</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#4C4F69">        emailNotifier</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">sendWelcomeEmail</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">email</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">    </span></span>
<span class="line"><span style="color:#1E66F5;font-style:italic">        verify</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">emailService</span><span style="color:#7C7F93">,</span><span style="color:#1E66F5;font-style:italic"> times</span><span style="color:#7C7F93">(</span><span style="color:#FE640B">1</span><span style="color:#7C7F93">)).</span><span style="color:#1E66F5;font-style:italic">send</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">email</span><span style="color:#7C7F93">,</span><span style="color:#40A02B"> &quot;Welcome to our app!&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"><span style="color:#7C7F93">}</span></span></code></pre>
<p>The final part we need to verify is the UserManager, where we bring it all together. For our UserManager unit tests, we should focus on verifying collaboration, ensuring it effectively delegates tasks to the appropriate interfaces, such as UserRepository and EmailNotifier. Instead of checking internal state changes, we should utilise mocks for these components. This approach will allow us to assert that the interfaces were indeed called, indicating successful orchestration.</p>
<pre class="astro-code catppuccin-latte" style="background-color:#eff1f5;color:#4c4f69;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word" tabindex="0" data-language="java"><code><span class="line"><span style="color:#8839EF">class</span><span style="color:#DF8E1D;font-style:italic"> UserManagerTests</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> UserManager</span><span style="color:#4C4F69"> userManager</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> UserRepository</span><span style="color:#4C4F69"> userRepository</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> EmailNotifier</span><span style="color:#4C4F69"> emailNotifier</span><span style="color:#7C7F93">;</span></span>
<span class="line"><span style="color:#8839EF">    private</span><span style="color:#8839EF"> Logger</span><span style="color:#4C4F69"> logger</span><span style="color:#7C7F93">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FE640B">    @BeforeEach</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> init</span><span style="color:#7C7F93">()</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        userRepository </span><span style="color:#179299">=</span><span style="color:#1E66F5;font-style:italic"> mock</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">UserRepository</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">class</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        emailNotifier </span><span style="color:#179299">=</span><span style="color:#1E66F5;font-style:italic"> mock</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">EmailNotifier</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">class</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        logger </span><span style="color:#179299">=</span><span style="color:#1E66F5;font-style:italic"> mock</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">Logger</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">class</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        </span></span>
<span class="line"><span style="color:#4C4F69">        userManager </span><span style="color:#179299">=</span><span style="color:#8839EF"> new</span><span style="color:#1E66F5;font-style:italic"> UserManager</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">userRepository</span><span style="color:#7C7F93">,</span><span style="color:#4C4F69"> emailNotifier</span><span style="color:#7C7F93">,</span><span style="color:#4C4F69"> logger</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FE640B">    @Test</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> testCreateUser</span><span style="color:#7C7F93">()</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        userManager</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">createUser</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;testUser&quot;</span><span style="color:#7C7F93">,</span><span style="color:#40A02B"> &quot;testUser@mail.com&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        </span></span>
<span class="line"><span style="color:#1E66F5;font-style:italic">        verify</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">userRepository</span><span style="color:#7C7F93">,</span><span style="color:#1E66F5;font-style:italic"> times</span><span style="color:#7C7F93">(</span><span style="color:#FE640B">1</span><span style="color:#7C7F93">)).</span><span style="color:#1E66F5;font-style:italic">save</span><span style="color:#7C7F93">(</span><span style="color:#1E66F5;font-style:italic">any</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">User</span><span style="color:#7C7F93">.</span><span style="color:#4C4F69">class</span><span style="color:#7C7F93">));</span></span>
<span class="line"><span style="color:#1E66F5;font-style:italic">        verify</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">emailNotifier</span><span style="color:#7C7F93">,</span><span style="color:#1E66F5;font-style:italic"> times</span><span style="color:#7C7F93">(</span><span style="color:#FE640B">1</span><span style="color:#7C7F93">)).</span><span style="color:#1E66F5;font-style:italic">sendWelcomeEmail</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;testUser@mail.com&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#1E66F5;font-style:italic">        verify</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">logger</span><span style="color:#7C7F93">,</span><span style="color:#1E66F5;font-style:italic"> times</span><span style="color:#7C7F93">(</span><span style="color:#FE640B">1</span><span style="color:#7C7F93">)).</span><span style="color:#1E66F5;font-style:italic">log</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;User created: {}&quot;</span><span style="color:#7C7F93">,</span><span style="color:#40A02B"> &quot;testUser&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FE640B">    @Test</span></span>
<span class="line"><span style="color:#8839EF">    void</span><span style="color:#1E66F5;font-style:italic"> testDeleteUser</span><span style="color:#7C7F93">()</span><span style="color:#7C7F93"> {</span></span>
<span class="line"><span style="color:#4C4F69">        userManager</span><span style="color:#7C7F93">.</span><span style="color:#1E66F5;font-style:italic">deleteUser</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;testUser@mail.com&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#4C4F69">        </span></span>
<span class="line"><span style="color:#1E66F5;font-style:italic">        verify</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">userRepository</span><span style="color:#7C7F93">,</span><span style="color:#1E66F5;font-style:italic"> times</span><span style="color:#7C7F93">(</span><span style="color:#FE640B">1</span><span style="color:#7C7F93">)).</span><span style="color:#1E66F5;font-style:italic">deleteById</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;testUser@mail.com&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#1E66F5;font-style:italic">        verify</span><span style="color:#7C7F93">(</span><span style="color:#4C4F69">logger</span><span style="color:#7C7F93">,</span><span style="color:#1E66F5;font-style:italic"> times</span><span style="color:#7C7F93">(</span><span style="color:#FE640B">1</span><span style="color:#7C7F93">)).</span><span style="color:#1E66F5;font-style:italic">log</span><span style="color:#7C7F93">(</span><span style="color:#40A02B">&quot;User deleted: {}&quot;</span><span style="color:#7C7F93">,</span><span style="color:#40A02B"> &quot;testUser@mail.com&quot;</span><span style="color:#7C7F93">);</span></span>
<span class="line"><span style="color:#7C7F93">    }</span></span>
<span class="line"><span style="color:#7C7F93">}</span></span></code></pre>
<h2 id="refactoring-is-about-purpose-not-perfection">Refactoring is About Purpose, Not Perfection</h2>
<p>Refactoring isn’t about making code look pretty. It’s about making the design better fit the problem. In our original <strong>UserManager</strong> class, the code worked, but it was brittle and hard to maintain. By separating the functionality, introducing abstraction, and refactoring in safe steps, we made it flexible, testable, and ready for future maintenance. Next time your face badly designed code, remember:</p>
<ul>
<li>Identify the problem before you touch code.</li>
<li>Select a more suitable direction based on the constraints.</li>
<li>Break the refactoring down into safe, reversible steps.</li>
</ul>
<p>Small, deliberate changes beat a massive rewrite every time. To put this into practice, I challenge you: identify one overgrown class in your codebase today and apply Step 1—Identify the problem. This initial step can pave the way for meaningful refactoring and tangible improvements in your projects.</p> </article>  </div> </section> </main> <section class="h-[80vh] flex items-center justify-center"> <div class="max-w-3xl w-full mx-auto px-4 space-y-12">  <p class="text-gray-400 text-center">
This space is intentionally left blank to help readers maintain a
            consistent eyeline.
</p>  </div> </section> <footer class="mt-auto"> <div class="max-w-3xl w-full mx-auto px-4 space-y-12">  <div class="my-8"> <div class="text-sm text-center text-gray-500">
Copyright &copy; 2025 BIOS Confessions. All rights reserved.
</div> </div>  </div> </footer>  </body></html>